---
title: ç”µæ¢¯ç»„ä»¶
slug: components
summary: 'ç”µæ¢¯ç»„ä»¶ æ»šåŠ¨é¡µé¢è‡ªåŠ¨é”šç‚¹å¯¼èˆª'
date: '2025-06-04'
featured_image_url: /blogs/elevator/cover.png
tags:
  - components
  - elevator
---


## ç”µæ¢¯ç»„ä»¶


![](/blogs/elevator/index.gif)


### ğŸ“Œ ç”µæ¢¯ç»„ä»¶ä»‹ç»

åœ¨æ—¥å¸¸å¼€å‘ä¸­, å°¤å…¶æ˜¯é¡µé¢å†…å®¹è¾ƒé•¿ã€åŒ…å«å¤šä¸ªåŒºåŸŸçš„åœºæ™¯ä¸‹(å¦‚å•†å“èœå•é¡µã€å•†å“è¯¦æƒ…é¡µã€è¡¨å•å¯¼èˆªç­‰), æˆ‘ä»¬å¸¸å¸¸éœ€è¦å®ç°ä¸€ç§ `é”šç‚¹å¯¼èˆª` çš„èƒ½åŠ›, 
æ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿè·³è½¬åˆ°é¡µé¢çš„å„ä¸ªéƒ¨åˆ†, å¹¶ä¸”é€šè¿‡æ»šåŠ¨æ—¶è‡ªåŠ¨é«˜äº®å½“å‰çš„å¯¼èˆªé¡¹ç›®ã€,æå‡ç”¨æˆ·ä½“éªŒ

è¿™é‡Œä»‹ç»ä¸€ä¸ªè‡ªç ” `ç”µæ¢¯ç»„ä»¶` çš„å®ç°æ€è·¯å’Œæ•ˆæœ. å®ƒå®ç°äº†:

- ğŸ“ é”šç‚¹å®šä½è·³è½¬ï¼šç‚¹å‡»å¯¼èˆªé¡¹ï¼Œé¡µé¢å¹³æ»‘æ»šåŠ¨è‡³å¯¹åº”å†…å®¹åŒºåŸŸï¼›

- ğŸ”„ æ»šåŠ¨è”åŠ¨é«˜äº®ï¼šæ»šåŠ¨é¡µé¢æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°å½“å‰æ‰€åœ¨çš„å¯¼èˆªé¡¹ï¼›

- âš™ï¸ å¯é…ç½®å¯¼èˆªé¡¹ä¸å†…å®¹ç»“æ„ï¼šæ”¯æŒä»»æ„è‡ªå®šä¹‰å¯¼èˆªé¡¹ä¸å¯¹åº”åŒºåŸŸï¼›

- ğŸ¯ æ”¯æŒåµŒå¥—å¸ƒå±€ä¸å¸é¡¶å¯¼èˆªï¼šé€‚ç”¨äºå¤æ‚å¸ƒå±€ä¸­çš„æ»šåŠ¨å®¹å™¨ã€‚


### ğŸ“ å‰ç½®çŸ¥è¯†ï¼šç†è§£æ»šåŠ¨ç›¸å…³çš„ DOM å±æ€§

åœ¨æ„å»º `ç”µæ¢¯ç»„ä»¶` æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€äº›ä¸æ»šåŠ¨å¸ƒå±€å¯†åˆ‡ç›¸å…³çš„ DOM å±æ€§ã€‚ä¸‹é¢ç®€å•ä»‹ç»å‡ ä¸ªæ ¸å¿ƒ API çš„ä½œç”¨å’Œå·®å¼‚ï¼š


| å±æ€§å | å«ä¹‰ | 
| --- | --- | 
| `clientHeight` | å¯è§†åŒºåŸŸé«˜åº¦,ä¸åŒ…æ‹¬æ»šåŠ¨æ¡æˆ– border éƒ¨åˆ† | 
| `scrollHeight` | æ•´ä¸ªå†…å®¹é«˜åº¦ï¼ˆåŒ…æ‹¬æº¢å‡ºéšè—éƒ¨åˆ†ï¼‰ã€‚å†…å®¹è¶…å‡ºå¯è§†åŒºåŸŸçš„éƒ¨åˆ†ä¹Ÿä¼šç®—è¿›æ¥ã€‚ | 
| `scrollTop`| æ»šåŠ¨çš„è·ç¦»ï¼Œå³å½“å‰æ»šåŠ¨æ¡ä»é¡¶éƒ¨æ»šåŠ¨äº†å¤šå°‘åƒç´  |
| `offsetTop`| 	å…ƒç´ è·çˆ¶å®¹å™¨é¡¶ç«¯çš„è·ç¦» |


```tsx
const rect = element.getBoundingClientRect()
```

rect æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å±æ€§çš„å¯¹è±¡ï¼š

| å±æ€§å | å«ä¹‰ | 
| --- | --- | 
| `top` | å…ƒç´ é¡¶éƒ¨åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦» | 
| `left` | å…ƒç´ å·¦è¾¹åˆ°è§†å£å·¦è¾¹çš„è·ç¦» | 
| `bottom`| å…ƒç´ åº•éƒ¨åˆ°è§†å£é¡¶éƒ¨çš„è·ç¦» |
| `right`| å…ƒç´ å³è¾¹åˆ°è§†å£å·¦è¾¹çš„è·ç¦» |
| `width`| å…ƒç´ è‡ªèº«çš„å®½åº¦ |
| `height`| å…ƒç´ è‡ªèº«çš„é«˜åº¦ |


âœ… `scrollTop` vs `offsetTop` å¯¹æ¯”

| å±æ€§          | å«ä¹‰                                  | ä½¿ç”¨åœºæ™¯              | å•ä½   | ç¤ºä¾‹å€¼ | è¯´æ˜               |
| ----------- | ----------------------------------- | ----------------- | ---- | --- | ---------------- |
| `scrollTop` | **æŸä¸ªå¯æ»šåŠ¨å®¹å™¨**å·²æ»šåŠ¨çš„å‚ç›´è·ç¦»                 | åˆ¤æ–­æ»šåŠ¨æ¡æ»šäº†å¤šå°‘ï¼Œè§¦å‘å¸é¡¶ç­‰   | `px` | 120 | å®¹å™¨å‘ä¸‹æ»šåŠ¨äº† 120 åƒç´    |
| `offsetTop` | å½“å‰å…ƒç´ **ç›¸å¯¹äºå®šä½çˆ¶å…ƒç´ ï¼ˆoffsetParentï¼‰é¡¶éƒ¨**çš„åç§» | è®¡ç®—é”šç‚¹å…ƒç´ çš„çœŸå®ä½ç½®ï¼ˆç»å¯¹ä½ç½®ï¼‰ | `px` | 300 | å…ƒç´ åœ¨é¡µé¢ä¸­ç¦»é¡¶éƒ¨ 300 åƒç´  |



â— å¸¸è§è¯¯åŒº

> åªæœ‰ èƒ½æ»šåŠ¨çš„å…ƒç´  æ‰èƒ½ç”¨ `scrollTop` å¦åˆ™å®ƒ  å§‹ç»ˆæ˜¯ `0`


ğŸ§  å®ç°åŸç†è§£æ

1. å¸ƒå±€ç»“æ„

ç»„ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

- å·¦ä¾§èœå•ï¼ˆå¯¼èˆªï¼‰ï¼šç‚¹å‡»èœå•é¡¹å¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„å†…å®¹åŒºåŸŸã€‚

- å³ä¾§æ»šåŠ¨å†…å®¹åŒºåŸŸï¼šå±•ç¤ºæ¯ä¸ªåŒºå—å†…å®¹ï¼Œç›‘å¬å…¶æ»šåŠ¨ä½ç½®å˜åŒ–ä¸å·¦ä¾§å¯¼èˆªè”åŠ¨ã€‚


2. é”šç‚¹è·³è½¬æœºåˆ¶

ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ—¶:

- è·å–ç›®æ ‡å†…å®¹å—çš„ `offsetTop`
- æ ¹æ® `offsetTop`ï¼ˆå¤´éƒ¨é«˜åº¦åç§»é‡ï¼‰è®¡ç®—ç²¾ç¡®æ»šåŠ¨ç›®æ ‡
- ä½¿ç”¨ `scrollTo({ top, behavior: 'smooth' })` å¹³æ»‘æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
- å…³é—­æ»šåŠ¨ç›‘å¬, ç­‰æ»šåŠ¨ç»“æŸåå†é‡æ–°å¼€å¯ç›‘å¬(é˜²æ­¢è·³è½¬æ—¶, èœå•ç›®å½•è·Ÿç€è”åŠ¨è·³è½¬)

```tsx
 const jumpTarget = async (val: string) => {
    wrapperRef?.current?.removeEventListener('scroll', handleScroll)
    const target = wrapperRef.current?.querySelector(`#${val}`)!
    let top = (target as HTMLDivElement).offsetTop

    if (offset) {
      top = top - offset
    }
    setActiveKey(val)

    // æ‰§è¡Œå¹³æ»‘æ»šåŠ¨
    wrapperRef?.current?.scrollTo({
      top,
      behavior: 'smooth',
    })

    // ç­‰å¾…æ»šåŠ¨å®Œæˆåå†æ·»åŠ ç›‘å¬å™¨
    await waitForScrollEnd(wrapperRef.current!)
    wrapperRef?.current?.addEventListener('scroll', handleScroll)
  }
```

3. æ»šåŠ¨è”åŠ¨æœºåˆ¶

æ»šåŠ¨å†…å®¹åŒºåŸŸæ—¶ï¼š

- èŠ‚æµè§¦å‘ `handleScroll` é¿å…æ€§èƒ½é—®é¢˜
- è·å–æ»šåŠ¨å®¹å™¨çš„ `scrollTop` åˆ¤æ–­å½“å‰æ»šåŠ¨ä½ç½®
- å°†å½“å‰æ»šåŠ¨ä½ç½®ä¸æ‰€æœ‰å†…å®¹å—ä½ç½®è¿›è¡Œæ¯”å¯¹ï¼Œå¾—å‡ºå½“å‰å¤„äºå“ªä¸ªåŒºå—ï¼Œå¹¶è®¾ç½®ä¸ºæ¿€æ´»é¡¹ `activeKey`
ç‰¹æ®Šå¤„ç†ï¼š
- å¦‚æœå·²ç»æ»šåŠ¨åˆ°åº•éƒ¨ `ï¼ˆå®¹å™¨é«˜åº¦ + scrollTop >= scrollHeightï¼‰` åˆ™ç›´æ¥æ¿€æ´»æœ€åä¸€ä¸ªåŒºå—


```tsx
// èŠ‚æµ hooks
  const { run: handleScroll } = useThrottleFn(
    () => {
        // è·å–æ»šåŠ¨å®¹å™¨çš„ `scrollTop` åˆ¤æ–­å½“å‰æ»šåŠ¨ä½ç½®
      const scrollTop = wrapperRef?.current?.scrollTop!

      let isScrollBottom
      if (offset) {
        isScrollBottom =
          wrapperRef?.current?.clientHeight +
            wrapperRef?.current?.scrollTop +
            offset >=
          wrapperRef?.current?.scrollHeight
      } else {
        // å¦‚æœå·²ç»æ»šåŠ¨åˆ°åº•éƒ¨ `ï¼ˆå®¹å™¨é«˜åº¦ + scrollTop >= scrollHeightï¼‰` åˆ™ç›´æ¥æ¿€æ´»æœ€åä¸€ä¸ªåŒºå—
        isScrollBottom =
          wrapperRef?.current?.clientHeight + wrapperRef?.current?.scrollTop >=
          wrapperRef?.current?.scrollHeight
      }
      if (isScrollBottom) {
        const lastKey = items[items.length - 1].key
        setActiveKey(lastKey)
      } else {
        // floorHeight ä¸ºåˆå§‹åŒ–ç»„ä»¶çš„æ—¶å€™ è®°å½•çš„æ¯ä¸€ä¸ªåŒºåŸŸ çš„ { key, name,  height } heigh: å„ä¸ªåŒºåŸŸå¿«è·ç¦»å®¹å™¨é¡¶éƒ¨çš„ offsetTop
        // å°†å½“å‰æ»šåŠ¨ä½ç½®ä¸æ‰€æœ‰å†…å®¹å—ä½ç½®è¿›è¡Œæ¯”å¯¹ï¼Œå¾—å‡ºå½“å‰å¤„äºå“ªä¸ªåŒºå—
        let j: number | undefined
        for (let i = 0; i < floorHeight.length; i++) {
          const targetFloor = floorHeight[i]

          if (scrollTop >= targetFloor.height) {
            j = i
            break
          }
        }
        const targetKey = floorHeight[j].key

        setActiveKey(targetKey)
      }
    },
    { wait: 150, leading: true },
  )
```


## ğŸš§ å¾…å®Œå–„åŠŸèƒ½ï¼ˆTo-Doï¼‰

- [ ] å¸é¡¶å¯¼èˆªæ”¯æŒ: å®ç°å³ä¾§æ»šåŠ¨å†…å®¹åŒºå—çš„æ ‡é¢˜å¸é¡¶æ•ˆæœï¼Œæå‡é˜…è¯»ä½“éªŒï¼ˆå¯é…åˆ position: sticky å®ç°ï¼‰ã€‚
- [ ] æ»šåŠ¨åŠ¨ç”»å›å¼¹ä¼˜åŒ–: å½“å‰ scrollTo ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿå¹³æ»‘æ»šåŠ¨ï¼Œåç»­å¯æ¥å…¥è‡ªå®šä¹‰æ»šåŠ¨åŠ¨ç”»ï¼ˆå¦‚è´å¡å°”æ›²çº¿ï¼‰å¢å¼ºæµç•…åº¦ä¸æ§åˆ¶ã€‚
- [ ] æ”¯æŒåŠ¨æ€å†…å®¹é«˜åº¦å˜åŒ–: å½“å‰æ¥¼å±‚ä½ç½®é«˜åº¦æ˜¯åˆå§‹åŒ–æ—¶è®¡ç®—çš„ï¼Œè‹¥å†…å®¹å¼‚æ­¥åŠ è½½æˆ–åŠ¨æ€å˜åŒ–ï¼Œé«˜åº¦è®¡ç®—å¯èƒ½ä¸å‡†ç¡®ï¼Œåç»­å¯è€ƒè™‘ç›‘å¬ DOM å˜åŒ–ï¼ˆå¦‚ ResizeObserverï¼‰è‡ªåŠ¨æ›´æ–°ã€‚



## ä»£ç ä»“åº“

[BlueOrgreen/yunfan-website](https://github.com/BlueOrgreen/yunfan-website)
